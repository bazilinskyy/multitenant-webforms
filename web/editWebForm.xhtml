<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:c="http://java.sun.com/jsp/jstl/core">
    <f:view contentType="text/html" locale="#{sessionBean.language}">
        <f:event type="preRenderView" listener="#{home.prerender}"/>
        <h:head>
            <link rel="stylesheet" type="text/css" href="resources/mhgtheme/style.css"/>
            <link rel="stylesheet" type="text/css" href="resources/mhgtheme/mhgtheme.css"/>
            <link rel="shortcut icon" href="resources/mhgtheme/favicon.ico" />
            <title>Multitenant web forms - #{ui.editWebFormTITLE}</title>

            <script type="text/javascript" src="resources/js/googleMaps.js" />
            <script type="text/javascript" src="resources/js/jquery.js" />

            <SCRIPT language="JavaScript">
                /* <![CDATA[ */

                $(document).ready(function() {
                    for (var i = 1; i < 40; i++) {
                        var id = "editForm:editList:" + i + ":editPanel";
                        $('[id="' + id + '"]').hide();
                    }
                    
                    // Better way, requers reading: http://james.padolsey.com/javascript/regex-selector-for-jquery/
                    // Currently limited to 20 fields.
                    // TODO: improve logic using 1 function.

                    var id = "editForm:editList:" + "0" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "1" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "1" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "2" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })  
                    
                    var id = "editForm:editList:" + "2" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "3" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "3" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "4" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "4" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "5" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "5" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "6" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "6" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "7" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "7" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "8" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "8" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "9" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "9" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "10" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "10" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "11" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "11" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "12" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "12" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "13" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "13" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "14" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "14" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "15" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "15" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "16" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "16" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "17" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "17" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "18" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                    
                    var id = "editForm:editList:" + "18" + ":webFieldLabel";
                    $('[id="' + id + '"]').click(function(){
                        var id = "editForm:editList:" + "19" + ":editPanel";
                        $('[id="' + id + '"]').show(500);
                    })
                                           
                    return false;
                });
                
                function doPopup(source) {
                    popup = window.open(source, "popup", "height=460,width=540)");
                    popup.focus();
                }
                
                function doPopupSmall(source) {
                    popup = window.open(source, "popup", "height=300,width=275)");
                    popup.focus();
                }
                
                function doPopupTiny(source) {
                    popup = window.open(source, "popup", "height=100,width=275)");
                    popup.focus();
                }
            
                /* ]]> */
            </SCRIPT>

        </h:head>
        <h:body onload="load('editWebFormForm')">

            <div id="content">
                <ui:include src="include/hmenu.xhtml"/>
                <ui:include src="include/vertical_menu.xhtml"/>
                <span id="contentMain">
                    <div id="box">
                        <div id="boxHeader">
                            <h:outputText value="#{ui.editWebFormTITLE} --- #{ui.ID}: #{sessionBean.webForm.id}"/>
                        </div>
                        <div id="boxBody">
                            <h:form class="fillWebFormForm" id="editForm">
                                <h:panelGrid> 
                                    <f:facet name="header">
                                        <ui:include src="include/message.xhtml"/>
                                    </f:facet>

                                    <f:facet name="footer">
                                        <h:panelGroup>
                                            <h:commandButton styleClass="buttonSubmit" value="#{ui.submitBUTTON}"
                                                             action="#{webFormView.editWebForm}"
                                                             id="submitBtn">
                                                <f:param name="captchaGenerated" value="parameterValue1" />
                                            </h:commandButton>
                                            <h:commandButton styleClass="buttonSubmit" value="#{ui.reset}" type="reset"/>
                                            <h:commandButton styleClass="buttonSubmit" value="#{ui.back}" action="login"/>
                                        </h:panelGroup>
                                    </f:facet>

                                    <!-- form's name -->
                                    <h:panelGrid columns="2" columnClasses="webFormPanelEdit1,webFormPanelEdit2">
                                        <h:outputLabel for="formName" id="formNameLbl" value="#{ui.formName}" styleClass="required"/>
                                        <h:panelGroup>
                                            <h:inputText id="formName" value="#{sessionBean.webForm.name}"
                                                         maxlength="255" size="30"/><br/>
                                            <h:outputText value=" "/><h:message for="formName" styleClass="formUserError"/>
                                        </h:panelGroup>
                                    </h:panelGrid>

                                    <!-- fields already in form -->
                                    <ui:repeat value="#{sessionBean.webFieldsInFormForUser}" var="webField">

                                        <li id="editLi">
                                            <h:panelGrid columns="5" columnClasses="webFormPanelEdit1,webFormPanelEdit2,webFormPanelEdit3,webFormPanelEdit4" id="editPanel">
                                                <h:panelGroup>
                                                    <!-- Delete checkbox -->
                                                    <h:selectBooleanCheckbox title="#{ui.deleteField}" id="deleteForm" value="#{webField.toBeDeleted}"/>
                                                    <h:inputText id="webFieldLabel" value="#{webField.label.en}"
                                                                 maxlength="255" size="20"/><br/>
                                                    <h:outputText value=" "/><h:message for="webFieldLabel" styleClass="formUserError"/>
                                                </h:panelGroup>

                                                <h:panelGroup rendered="#{!webField.child}">
                                                    <h:selectOneMenu id="webfieldTypeNotChild" value="#{webField.type}">
                                                        <f:selectItems value="#{webFormView.typeOptions}"/>
                                                    </h:selectOneMenu>
                                                </h:panelGroup>

                                                <h:panelGroup rendered="#{webField.child}">
                                                    <h:selectOneMenu id="webfieldTypeChild" value="#{webField.type}" disabled="true">
                                                        <f:selectItems value="#{webFormView.typeOptions}"/>
                                                    </h:selectOneMenu>
                                                </h:panelGroup>

                                                <h:panelGroup rendered="#{!webField.child}">
                                                    <h:selectOneMenu id="webfieldRequired" value="#{webField.required}">
                                                        <f:selectItems value="#{webFormView.requiredOptions}"/>
                                                    </h:selectOneMenu>
                                                </h:panelGroup>

                                                <h:panelGroup rendered="#{webField.child}">
                                                    <h:selectOneMenu id="webfieldRequiredChild" value="#{webField.required}" disabled="true">
                                                        <f:selectItems value="#{webFormView.requiredOptions}"/>
                                                    </h:selectOneMenu>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:inputText id="webfieldPosition" value="#{webField.positionInWebform}"
                                                                 maxlength="10" size="1"/><br/>
                                                    <h:outputText value=" "/><h:message for="webFieldLabel" styleClass="formUserError"/>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:commandLink id="editWebFieldStyleMother" value="#{ui.changeStyle}" onclick="doPopup('editWebFieldStyle.jsf?fieldId=#{webField.id}'); ">
                                                    </h:commandLink>
                                                    <h:outputText value=" :: "/>
                                                    <h:commandLink id="editWebFieldUserRights" value="#{ui.changeRights}" onclick="doPopupSmall('editWebFieldRights.jsf?fieldId=#{webField.id}'); ">
                                                    </h:commandLink>
                                                    <h:outputText value=" :: " rendered="#{!webField.child}"/>
                                                    <h:commandLink id="editWebFieldListOptions" value="#{ui.list}" onclick="doPopup('listOptions.jsf?fieldId=#{webField.id}'); " rendered="#{!webField.child}">
                                                    </h:commandLink>
                                                    <h:outputText value=" :: " rendered="#{!webField.child}"/>
                                                    <h:commandLink id="presetFieldChoose" value="#{ui.preset}" onclick="doPopupTiny('presetField.jsf?fieldId=#{webField.id}'); " rendered="#{!webField.child}">
                                                    </h:commandLink>

                                                    <!-- With output of Mother indicator -->
                                                    <h:outputText styleClass="motherField" value=" M" rendered="#{webField.mother}"/>
                                                    <h:outputText value=" "/>
                                                </h:panelGroup>

                                            </h:panelGrid>
                                        </li>

                                    </ui:repeat>

                                    <!-- new fields -->
                                    <ui:repeat value="#{sessionBean.newWebFieldsInForm}" var="newWebField" id="editList">

                                        <li id="editLi">
                                            <h:panelGrid columns="5" columnClasses="webFormPanelEdit1,webFormPanelEdit2,webFormPanelEdit3,webFormPanelEdit4" id="editPanel">
                                                <h:panelGroup id="newWebFieldPanel">
                                                    <h:inputText id="webFieldLabel" value="#{newWebField.label.en}"
                                                                 maxlength="255" size="20"/><br/>
                                                    <h:outputText value=" "/><h:message for="webFieldLabel" styleClass="formUserError"/>
                                                </h:panelGroup>  

                                                <h:panelGroup>
                                                    <h:selectOneMenu id="webfieldType" value="#{newWebField.type}">
                                                        <f:selectItems value="#{webFormView.typeOptions}"/>
                                                    </h:selectOneMenu>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:selectOneMenu id="webfieldRequired" value="#{newWebField.required}">
                                                        <f:selectItems value="#{webFormView.requiredOptions}"/>
                                                    </h:selectOneMenu>
                                                </h:panelGroup>

                                                <h:panelGroup>
                                                    <h:inputText id="webfieldPosition" value="#{newWebField.positionInWebform}"
                                                                 maxlength="10" size="1"/><br/>
                                                    <h:outputText value=" "/><h:message for="webFieldLabel" styleClass="formUserError"/>
                                                </h:panelGroup>

                                                <h:outputText value=" "/><h:message for="webfield" styleClass="formUserError"/>

                                            </h:panelGrid>
                                        </li>

                                    </ui:repeat>

                                    <!-- user rights -->
                                    <h:panelGrid columns="2" columnClasses="webFormPanelEdit1,webFormPanelEdit2">
                                        <h:outputLabel for="userRights" id="userRightsLbl" value="#{ui.userRights}"/>
                                        <h:selectManyListbox id="userRights" value="#{webFormView.userRightsSelected}" size="10">
                                            <f:selectItems value="#{webFormView.userRightsOptions}"/>
                                        </h:selectManyListbox>
                                    </h:panelGrid>

                                    <!-- captcha -->
                                    <h:panelGrid columns="2" columnClasses="webFormPanelEdit1,webFormPanelEdit2">
                                        <h:outputLabel for="captcha" id="captchaLbl" value="#{ui.captchaRequired}"/>
                                        <h:selectBooleanCheckbox id="captcha" value="#{sessionBean.webForm.captchaRequired}" />
                                    </h:panelGrid>
                                    
                                    <!-- can be mother -->
                                    <h:panelGrid columns="2" columnClasses="webFormPanelEdit1,webFormPanelEdit2">
                                        <h:outputLabel for="canBeMother" id="canBeMotherLbl" value="#{ui.canBeMother}"/>
                                        <h:selectBooleanCheckbox id="canBeMother" value="#{sessionBean.webForm.canBeMotherBool}" />
                                    </h:panelGrid>
                                    
                                    <!-- delete form -->
                                    <h:panelGrid columns="2" columnClasses="webFormPanelEdit1,webFormPanelEdit2">
                                        <h:outputLabel for="deleteForm" id="deleteFormLbl" value="#{ui.deleteForm}" style="color:red"/>
                                        <h:selectBooleanCheckbox id="deleteForm" value="#{sessionBean.deleteForm}" onclick="return confirm('#{ui.doYouWantToDeleteForm}');"/>
                                    </h:panelGrid>

                                </h:panelGrid> 
                            </h:form>
                        </div>
                    </div>
                </span>
            </div>
        </h:body>
    </f:view>
</html>

